# Plano de Implementação: Sincronização Automática e Observador WhatsApp

Vou refatorar o serviço de sincronização e o webhook para atender aos requisitos de limpeza de logs, limites de histórico e automação em tempo real.

## 1. Limpeza e Refatoração do Webhook (Observador)

**Arquivo:** `src/app/api/webhooks/evolution/route.ts`

* **Remover Logs:** Excluir todos os `console.log` para limpar a saída.

* **Filtro de Grupos:** Adicionar verificação explícita para ignorar mensagens de grupos (`@g.us`) e transmissões, garantindo que apenas chats privados sejam processados.

* **Automação:** O webhook já possui a lógica de `MESSAGES_UPSERT` que cria contatos automaticamente. Vou garantir que essa lógica permaneça robusta e silenciosa.

## 2. Ajuste na Sincronização Inicial (Pull)

**Arquivo:** `src/services/whatsapp/sync.ts`

* **Remover Logs:** Limpar todas as saídas de console.

* **Lógica de "Últimas 10 Conversas":**

  * Ao iniciar a sincronização (`fullSync`), verificarei se já existem conversas no banco.

  * Se for a primeira vez (banco vazio), limitarei a busca às **10 conversas mais recentes** retornadas pela API.

  * Se já houver dados, manterei a sincronização padrão para garantir integridade, mas respeitando os filtros.

* **Filtro de Grupos:** Aplicar o filtro `!id.includes('@g.us')` também na busca inicial de chats.

* **Limite de Mensagens:** Alterar a busca de mensagens para limitar a **20 mensagens** por conversa (assumindo as 20 mais recentes para contexto imediato).

## 3. Registro de Contatos

* O sistema já utiliza o `remoteJid` (número) como chave. Vou garantir que o `Conversation.create` no webhook e no sync salve corretamente o nome e número do contato conforme solicitado.

<br />

Buscar apenas as 20 primeiras mensagens mais recentes da conversa para que seja mais rápido a sincronização

<br />

